# vim 常用指令

## 文本替换

### 替换当前行中的内容：`:s/from/to/`（s即substitude）

| 表达式        | 说明                                                                               |
| ------------- | ---------------------------------------------------------------------------------- |
| `:s/from/to/`   | 将当前行中的第一个from，替换成to。如果当前行含有多个from，则只会替换其中的第一个。 |
| `:s/from/to/g`  | 将当前行中的所有from都替换成to。                                                   |
| `:s/from/to/gc` | 将当前行中的所有from都替换成to，但是每一次替换之前都会询问请求用户确认此操作。     |

> 注意：这里的from和to都可以是任何字符串，其中from还可以是正则表达式。


### 替换某一行的内容：`:33s/from/to/g`

| 表达式         | 说明                     |
| -------------- | ------------------------ |
| `:.s/from/to/g`  | 在当前行进行替换操作。   |
| `:33s/from/to/g` | 在第33行进行替换操作。   |
| `:$s/from/to/g`  | 在最后一行进行替换操作。 |

### 替换某些行的内容：`:10,20s/from/to/g`

| 表达式            | 说明                                             |
| ----------------- | ------------------------------------------------ |
| `:10,20s/from/to/g` | 对第10行到第20行的内容进行替换。                 |
| `:1,$s/from/to/g`   | 对第一行到最后一行的内容进行替换（即全部文本）。 |
| `:1,.s/from/to/g`   | 对第一行到当前行的内容进行替换。                 |
| `:.,$s/from/to/g`   | 对当前行到最后一行的内容进行替换。               |
| `:'a,'bs/from/to/g` | 对标记a和b之间的行（含a和b所在的行）进行替换。其中a和b是之前用m命令所做的标记。   |


### 替换所有行的内容：`:%s/from/to/g`

| 表达式        | 说明                     |
| ------------- | ------------------------ |
| `:%s/from/to/g` | 对所有行的内容进行替换。 |


### 替换命令的完整形式

`:[range]s/from/to/[flags]`

- s/from/to/  

> 把*from*指定的字符串替换成*to*指定的字符串，*from*可以是正则表达式。
  
- [range]  

> 有以下一些表示方法：  

- `不写range`     默认为光标所在的行。  
- `.`           光标所在的行。  
- `1`           第一行。  
- `$`           最后一行。  
- `33`          第33行。  
- `'a`          标记a所在的行（之前要使用`ma`做过标记）。  
- `.+1`         当前光标所在行的下面一行。  
- `$-1`         倒数第二行。（这里说明我们可以对某一行加减某个数值来取得相对的行）。  
- `22,33`       第22～33行。  
- `1,$`         第1行 到 最后一行。  
- `1,.`         第1行 到 当前行。  
- `.,$`         当前行 到 最后一行。  
- `'a,'b`       标记a所在的行 到 标记b所在的行。  
- `%`           所有行（与 `1,$` 等价）。  
- `?chapter?`   从当前位置向上搜索，找到的第一个chapter所在的行。（其中chapter可以是任何字符串或者正则表达式。)  
- `/chapter/`   从当前位置向下搜索，找到的第一个chapter所在的行。（其中chapter可以是任何字符串或者正则表达式。)  

注意，上面的所有用于range的表示方法都可以通过 `+`、`-` 操作来设置相对偏移量。

- [flags]

> 这里可用的flags有：  

- `无`      ：  只对指定范围内的第一个匹配项进行替换。  
- `g`       ：  对指定范围内的所有匹配项进行替换。  
- `c`       ：  在替换前请求用户确认。  
- `e`       ：  忽略执行过程中的错误。
注意：上面的所有flags都可以组合起来使用，比如 `gc` 表示对指定范围内的  
所有匹配项进行替换，并且在每一次替换之前都会请用户确认。

## 批量注释

多行注释：
- 进入`命令行模式`，按`ctrl + v`进入`visual block模式`，然后按`j`, 或者`k`选中多行，把需要注释的行标记起来
- 按大写字母`I`，再插入注释符，例如`//`
- 按`esc键`就会全部注释了

取消多行注释：
- 进入`命令行模式`，按`ctrl + v`进入**visual block模式**，按字母`l`横向选中列的个数，例如`//`需要选中2列
- 按字母`j`，或者`k`选中注释符号
- 按`d`键就可全部取消注释

## Vim块操作 [ctrl+v]

1、在普通模式下按`ctrl+v`或者`v`进入块操作模式

- `v`       按字符选择，选中按下`V`时光标所在的字符到当前光标所在字符间的内容  
- `V`　　　　按行选择  
- `Ctrl+V`  选择矩形字符块  

2、通过光标移动选中内容，可以进行**ydp操作**

- `y`       复制选中内容到粘贴板  
- `d`       删除选中内容  
- `p`       用粘贴板里的内容替换选中的内容  
- `=`       对齐选中内容  
- 对于矩阵字符块：`Shift` + `i` xxx `esc` :把xxx写到每一行的光标前面的位置 

3、批量缩进或反缩进，类似于文本编辑器中的格式化

- 选中多行，按`I`进入**插入模式**，写入`Tab`，之后按`ESC`，即可完成批量缩进的功能  
- 也可以写入内容，到选中的每一行的光标位置  

## 多文件编辑

> 参考：<https://linux.cn/article-9629-1.html>

!> 我们编辑的文件只是在内存中的映像,   在Vim术语中称为"缓冲区"

### 用缓冲区列表管理打开的文件

当打开多个文件时,可以用 :**`ls` 查看缓冲区列表**。

如,打开了多个文件：

```shell
vim *.c
```

输入 `:ls` 命令，得到

    1 %a   "hello.c"                      第 31 行
    2 #    "nihao.c"                      第 1 行
    3      "zhaimin.c"                    第 3 行

其中，**%**表示哪个文件在当前窗口可见， **#** 表示为轮换文件； 用 `ctrl-^`  可以在当前窗口文件与轮换文件之间切换；

用以下命令可以遍历缓冲区列表

- `:bnext`  切换为下一个文件;
- `:bprev`  切换为上一个文件;
- `:bfirst` 切换为第一个文件;
- `:blast`  切换为最后一个文件;
- `:buffer N`   切换为第N个文件;
- `:buffer {name}` 切换为名字为name的文件;

删除缓冲区列表

- `ddelete 编号`    #删除指定的编号；
- #或
- `m, n bdelete `   #删除指定的范围

### 缓冲区的参数列表

当用VIM打开多个文件时，如：

```sjell
vim *.c
```

输入 `:args` 命令，就会出现参数列表：

    [hello.c] nihao.c zhaimin.c

以上的三个参数就是VIM启动时传递给VIM的文件列表，其中[]表示处于活动状态的文件；

（注意：这个参数列表的内容是可以改变的）

如何填充参数列表呢？

方法一:使用文件名指定文件 `:args 1.txt 2.txt 3.txt`

 方法二:使用Glob 模式进行指定文件;即正则化通配符  
 如`:args *.txt `  
 注意: `*`符号用于匹配0个或多个符号,但是不会递归目录;  
 注意: `**`符号用于匹配0个或多个符号,它可以递归目录;

方法三: 使用反引号指定文件;  
原理:

- 该文件中放有要打开的文件名字;
- Vim会执行反撇号括起来的命令;

反撇号的打法:`Esc`下面的那个键;  
如:args `cat argument.txt`

### 处理多个缓冲区的方式

- `:w[rite]`    把缓冲区内容写入到磁盘;
- `:e[dit]!`    把磁盘文件重新写入到缓冲区;
- `:qa[all]!`   关闭所有的窗口;
- `:w[all]`     把所以改变写入到缓冲区;

另外：`edit + {filename}`会打开新的文件；

`edit + ｛路径｝`会打开netrw的管理文件系统。（配置一下*vimrc*文件**:set nocompatible** 和 **filetype plugin on** ; netrw是一个标配的插件)

### 在工作区打开多个窗口及切换

> 复制一个当前的窗口： 使用`ctrl-w + s` 水平复制一个当前缓冲区，使用`ctrl-w + v` 垂直复制一个当前缓冲区；  
> 使用`:split {filename}` 与 `:vsplit {filename}` 水平或垂直打开一个新的文件；（可以省略写为`:sp`或`:vsp`）  
> 另外，也可以有新的窗口中利用 `:edit {filename}` 重新写入缓冲区中内容；

容器间的切换：

- `ctrl-w +w`       在窗口间循环切换;
- `ctrl-w +h`       切换到窗口左边;
- `ctrl-w +j`       切换到窗口下边;
- `ctrl-w +k`       切换到窗口上边;
- `ctrl-w +l`       切换到窗口右边;

窗口的关闭：

- `:close` 或`ctrl-w + c`     关闭活动窗口;
- `:only`  或`ctrl-w + o`     只保留活动窗口,其余都关闭;
