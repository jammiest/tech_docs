# 循环不变式

### 循环不变式（Loop Invariant）

#### 1. 定义
循环不变式是指在循环的每次迭代前后均保持为真的谓词（条件）。它用于证明循环的正确性，特别是在证明循环终止时能达到预期目标。形式上，对于一个循环：
```pseudo
while (条件) do
   循环体
end while
```
循环不变式 \( I \) 需满足以下三个性质：
1. **初始化（Initialization）**：在循环第一次迭代之前，\( I \) 为真。
2. **保持（Maintenance）**：如果某次迭代前 \( I \) 为真且循环条件成立，则执行循环体后 \( I \) 仍为真。
3. **终止（Termination）**：当循环终止时，\( I \) 和循环条件的假共同保证算法的正确性。

#### 2. 数学表达
设循环的初始状态为 \( S_0 \)，第 \( k \) 次迭代后的状态为 \( S_k \)，循环条件为 \( C \)，则循环不变式 \( I \) 满足：
- **初始化**：\( I(S_0) \) 为真。
- **保持**：若 \( I(S_k) \) 且 \( C(S_k) \) 为真，则执行循环体后 \( I(S_{k+1}) \) 为真。
- **终止**：当 \( C(S_k) \) 为假时，\( I(S_k) \) 能推导出循环的目标性质。

#### 3. 示例：计算阶乘
考虑计算 \( n! \) 的循环：
```pseudo
i := 1
fact := 1
while i ≤ n do
   fact := fact * i
   i := i + 1
end while
```
**循环不变式**：\( I \equiv \text{fact} = (i-1)! \)  
- **初始化**：初始时 \( i=1 \), \( \text{fact}=1 \)，显然 \( 0! = 1 \) 成立。
- **保持**：假设第 \( k \) 次迭代前 \( \text{fact} = (i_k-1)! \)，执行循环体后 \( \text{fact} = \text{fact} \cdot i_k = i_k! \)，且 \( i_{k+1} = i_k + 1 \)，故 \( \text{fact} = (i_{k+1}-1)! \) 仍成立。
- **终止**：当 \( i = n+1 \) 时终止，此时 \( \text{fact} = n! \)，达成目标。

#### 4. 与数学归纳法的关系
循环不变式的证明类似于数学归纳法：
- **基例**：初始化对应归纳的基例（\( k=0 \)）。
- **归纳步**：保持性对应若 \( P(k) \) 成立则 \( P(k+1) \) 成立。
- **终止**：归纳的结论对应循环终止时的正确性。

#### 5. 应用场景
- **算法正确性证明**：如排序、搜索算法。
- **程序验证**：形式化方法中验证循环的行为。
- **复杂度分析**：辅助证明循环的边界条件。

#### 6. 注意事项
- **非唯一性**：一个循环可能有多个不变式，需选择能关联初始条件和终止目标的。
- **强度**：不变式需足够强以推导出目标性质，但不过强导致无法保持。
- **隐式不变式**：某些循环（如迭代法解方程）的不变式可能隐含收敛性。

#### 7. 推广：递归不变式
递归函数的正确性可通过类似“递归不变式”证明，即在递归调用前后保持的性质，与数学归纳法高度一致。

循环不变式是连接算法直观与形式化证明的核心工具，其严谨性是程序正确性的基石。